CREATE OR REPLACE PROCEDURE RES_PROCESS(P_STU_ID NUMBER) IS  
    T_MARKS  NUMBER :=0;
    T_PERCENT  NUMBER;
    T_GRADE  VARCHAR2(2);
    T_STAT  VARCHAR2(5); 
    T_MAX_MARKS NUMBER :=0;
BEGIN
    SELECT SUM(MARK_OBTAIN), SUM(MARK_MAX)
    INTO T_MARKS, T_MAX_MARKS
    FROM OERPS_MARKS
    WHERE STU_ID = P_STU_ID;

    T_PERCENT := (T_MARKS/T_MAX_MARKS)*100;
    T_GRADE := CAL_GRADE(T_MARKS);

    IF T_PERCENT >= 40 THEN
        T_STAT:= 'PASS';
    ELSE 
        T_STAT := 'FAIL';
    END IF;

    INSERT INTO OERPS_RESULTS(RESULT_ID, STU_ID, STU_GRADE,TOTAL_MARKS, PERCENT, RES_STAT,STU_RANK)
    VALUES(OERPS_RES_SEQ.NEXTVAL,P_STU_ID, T_GRADE,T_MARKS,T_PERCENT,T_STAT,NULL);


END;
/


